---
description: Detect and prevent software and data integrity failures in WordPress as defined in OWASP Top 10:2021-A08
globs: *.php, composer.json, package.json
alwaysApply: false
---
# WordPress Software and Data Integrity Failures Standards (OWASP A08:2021)

This rule enforces security best practices to prevent software and data integrity failures in WordPress applications, as defined in OWASP Top 10:2021-A08.

## Rule Details

- **Name:** wordpress_integrity_failures

- **Description:** Detect and prevent software and data integrity failures in WordPress as defined in OWASP Top 10:2021-A08

## Filters
- file extension pattern: `\.(php|json)$`
- file path pattern: `.*`

## Enforcement Checks
- Conditions:
  - pattern `unserialize\(\$|unserialize\([^,]+\$|php_unserialize\(\$` – Insecure PHP deserialization detected. Use safer alternatives like JSON for data interchange or implement proper validation before deserialization.
    - Pattern 1: Insecure deserialization
  - pattern `eval\(|assert\(|create_function\(` – Potentially dangerous code execution function detected. Avoid dynamic code execution whenever possible.
    - Pattern 2: Unsafe use of eval or similar functions
  - pattern `require(_once)?\s*\(\s*\$|include(_once)?\s*\(\s*\$` – Dynamic inclusion of files based on user input is dangerous. Use validated, allowlisted paths only.
    - Pattern 3: Insecure plugin/file loading
  - pattern `add_action\(['"]upgrader_process_complete['"]|do_action\(['"]upgrader_process_complete['"]` – Ensure update hooks validate the integrity of updates and data transformations to prevent unauthorized modifications.
    - Pattern 4: Missing update verification
  - pattern `import_theme_options|import_widgets|wp_import` – Validate data before import to ensure integrity and detect potentially malicious changes.
    - Pattern 5: Unsafe configuration imports
  - pattern `wp_remote_get\(|wp_remote_post\(|file_get_contents\(['"]http` – Always validate data from remote sources before processing or storing it. Implement integrity checks for remote content.
    - Pattern 6: Unchecked remote data
  - pattern `composer\.json|package\.json` – Verify you're using secure dependency management: validate package signatures, pin dependencies, and use lock files.
    - Pattern 7: Insecure dependency management
  - pattern `\$wpdb->(insert|update|delete)\([^)]*\)(?!.*prepare)` – Direct database modifications should implement validation to preserve data integrity. Prefer using WordPress functions.
    - Pattern 8: Direct database modifications
  - pattern `wp_handle_upload\(|move_uploaded_file\(|wp_upload_bits\(` – Implement file integrity checking for uploaded files to prevent malicious content.
    - Pattern 9: Missing file integrity verification
  - pattern `wp_insert_post\(|wp_update_post\(|wp_create_user\(` – Validate all input used to create WordPress objects to maintain data integrity and prevent creating malicious content.
    - Pattern 10: Unsafe object creation

## Suggestions
- Guidance:
**WordPress Data & Software Integrity Best Practices:**

1. **Secure Deserialization:**
   - Avoid PHP's unserialize() with untrusted data entirely
   - Use JSON (json_encode/json_decode) or other structured formats for data interchange
   - When deserialization is necessary, implement allowlists and validation
   - Consider using WordPress's built-in data structures
   - Avoid serializing sensitive data that could be tampered with

2. **Update & Configuration Integrity:**
   - Validate data before and after migrations/updates
   - Implement checksums/hashing for critical configuration
   - Use WordPress's Options API properly
   - Monitor configuration changes for unauthorized modifications
   - Implement proper workflow for configuration management

3. **Dependency & Plugin Security:**
   - Verify the integrity of downloaded plugins and themes
   - Use Composer with package signature verification
   - Pin dependencies to specific versions in production
   - Maintain awareness of security advisories
   - Implement proper validation for plugin/theme loading

4. **CI/CD Pipeline Security:**
   - Sign build artifacts
   - Verify signatures during deployment
   - Implement proper secrets management
   - Control access to build and deployment systems
   - Validate code changes through code reviews

5. **Data Integrity Validation:**
   - Use database constraints to enforce data integrity
   - Implement validation at every layer of the application
   - Add integrity checks for critical data flows
   - Maintain audit logs for data modifications
   - Regularly verify data consistency

## Validation Checks
- Conditions:
  - pattern `json_encode|json_decode|wp_json_encode\(|wp_json_decode\(` – Using safer serialization alternatives.
    - Check 1: Secure serialization alternatives
  - pattern `wp_insert_post\([^)]*,\s*\[[^\]]*'post_status'[^\]]*\]\)|wp_update_post\([^)]*\)` – Properly validating post data.
    - Check 2: Proper data validation
  - pattern `wp_verify_file_signature|hash_file\(` – Implementing file validation.
    - Check 3: File verification
  - pattern `wp_check_filetype\(|wp_handle_upload\([^)]*,\s*\[[^\]]*test_form[^\]]*\]\)` – Using file validation mechanisms.
    - Check 4: Safe file handling

## Metadata
- Priority: high
- Version: 1.1
- Tags: security, wordpress, integrity, deserialization, owasp, language:php, framework:wordpress, category:security, subcategory:integrity, standard:owasp-top10, risk:a08-integrity-failures
## References
- https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/
- https://developer.wordpress.org/plugins/security/data-validation/
- https://developer.wordpress.org/reference/functions/wp_handle_upload/
